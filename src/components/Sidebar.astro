---
import { getCollection } from 'astro:content';
import ThemeToggle from './ThemeToggle.astro';

const groups = await getCollection('groups');
// Sort by filename (01-, 02-) implicitly usually works, or sort manually
const sortedGroups = groups.sort((a, b) => a.id.localeCompare(b.id));
---

<aside id="sidebar" class="fixed left-0 top-0 z-40 h-screen w-64 -translate-x-full border-r border-slate-200 bg-sidebar-light transition-transform md:translate-x-0 dark:border-slate-700 dark:bg-sidebar-dark">
  <div class="flex h-16 items-center justify-between px-6 border-b border-slate-100 dark:border-slate-800">
    <span class="text-xl font-bold text-blue-600">WebStack</span>
    <ThemeToggle />
  </div>
  
  <nav class="h-[calc(100vh-4rem)] overflow-y-auto p-4 scrollbar-thin">
    <ul class="space-y-1">
      {sortedGroups.map((group) => (
        <li>
          <a href={`#${group.id}`} class="flex items-center gap-3 rounded-lg px-4 py-3 text-slate-600 hover:bg-slate-100 hover:text-blue-600 dark:text-slate-400 dark:hover:bg-slate-800 dark:hover:text-blue-400 transition-colors">
            {/* We could use dynamic icons here if we map string names to Lucide components */}
            <span>{group.data.name}</span>
          </a>
        </li>
      ))}
    </ul>
  </nav>
</aside>

<div id="sidebar-overlay" class="fixed inset-0 z-30 hidden bg-black/50 backdrop-blur-sm md:hidden transition-opacity"></div>

<script>
  const sidebar = document.getElementById('sidebar');
  const overlay = document.getElementById('sidebar-overlay');
  const buttons = document.querySelectorAll('[data-toggle-sidebar]');

  function toggleSidebar() {
    sidebar?.classList.toggle('-translate-x-full');
    overlay?.classList.toggle('hidden');
  }

  buttons.forEach(btn => btn.addEventListener('click', toggleSidebar));
  overlay?.addEventListener('click', toggleSidebar);
</script>
